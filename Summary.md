# Summary

## BlockChain

> 为什么说区块链技术应用是从信息互联网到价值互联网

（围绕“不可复制”、“确权”、“价值交换”）。

> 区块链部署的三种形式，每种形式的特点，我国以哪种为主

- 公有链：节点加入无需准许，人人都可参与网络共识，任意读取数据，执行交易；PoW、PoS等。
- 联盟链：节点加入需要准许，多个机构组成联盟，数据读写等操作由联盟成员决定，效率高，节点可信度高；PBFT、Raft等。
- 私有链：写入权限掌握在一个组织内部，读取或开放或限制。

国内以联盟链为主。

> 区块链的六层架构

- 应用层：dapp
- 合约层：智能合约
- 激励层：挖矿
- 共识层：共识机制
- 网络层：P2P
- 数据层：数据结构，数据库

> 公有链激励层中的分配机制和发行机制

- 发行
  - ICO
  - IPO
  - IEO
  - 公私募
- 分配
  - 空投
  - 流动性挖矿
  - 质押挖矿
  - 社区成员分配

## Bitcoin

> 比特币区块头数据结构，每个字段长度及意义

区块头包含：上一个区块头哈希、默克尔树根哈希、版本号、时间戳、当前挖矿难度、随机数；共80个字节，前2个各32位，后4个各4位。

> 比特币密钥和地址生成过程，为什么通过地址推导公钥哈希

私钥：256位由0和1组成的随机数，以64位16进制显示。

公钥：私钥通过一个椭圆曲线算法(ECDSA)计算而来，不可逆，即不能根据公钥倒推私钥。

地址：公钥先通过单向哈希(SHA256, RIPEMD160)计算出公钥哈希，公钥哈希通过Base58check编码得到地址。

因为地址是公钥哈希通过Base58check编码得来的，所以地址逆向变换可得公钥哈希。

> 比特币交易流程

1. 交易的创建：线上线下都可。
2. 广播交易：广播到P2P网络，全网节点收到验证。
3. 交易验证与挖矿：从交易池中选一系列交易，矿工挖出区块。
4. 交易确认：待新块中全部交易验证完成后，各节点将该块添加到区块链尾部（上链）。
5. 确认有效：经过6个区块（1个小时）确认后即有效，永久保存于链上。

> 锁定脚本与解锁脚本位置

锁定脚本在输入列表中，解锁脚本在输出列表中。

> P2PKH执行过程，出入栈变化

1. 签名(sig)入栈。
2. 公钥(PubK)入栈。
3. 复制栈顶的公钥(DUP)。
4. 对栈顶的公钥进行哈希(HASH160)。
5. 压入公钥哈希(PubKHash)。
6. 判断栈顶的2个公钥哈希是否相等(EQUALVERIFY)，相等后这2个出栈。
7. 根据公钥检验签名(CHECKSIG)，正确后都出栈，栈顶显示TRUE。

> 比特币分叉类型及原因

- 临时分叉：算法导致，同时挖出2个甚至多个块。
- 硬分叉：升级系统，新规则无法向前兼容，旧节点无法认可新节点的区块。
- 软分叉：升级系统，可以向前兼容。

## Ethereum

> 以太坊解决了比特币的哪些问题

- 缺少图灵完备：比特币脚本语言非图灵完备。
- 价值盲：UTXO不可分割，转账金额不能精细控制。
- 缺少状态：UTXO只有是否花费，不能构建复杂合约。
- 区块链盲：看不到区块链的数据
- 速度慢：交易确认时间长，TPS低

> 以太坊发展的4个阶段

1. 前沿(Frontier)
2. 家园(Homestead)
3. 大都会(Metropolis)
4. 宁静(Serenity)

> 以太坊区块头的三棵树及作用

- 交易树：存交易
- 收据树：存交易生成的收据
- 状态树：存账户状态

> 以太坊账户类型

外部拥有账户(EOA)和合约账户(CA)

> 以太币(ether)与gas的区别

以太坊中2种不同的计量单位。

gas存在于EVM中；ether存在于以太坊账户中，最小货币单位为wei。

gas用来衡量执行每一步操作所需要支付的费用，其价格由ether来表示。

> 以太坊虚拟机可访问存储数据的空间有哪些，各自特点

- Storage：链上永久存储，gas开销大。
- Memory：临时存储，生命周期为方法执行期间，gas开销小。
- Stack：EVM不是基于寄存器，而是基于栈。

